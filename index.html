<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Argumentative Essay Assistant</title>
    <!-- Use Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
    </style>
</head>
<body class="bg-gray-100 p-4 sm:p-8 flex items-center justify-center min-h-screen">

    <!-- Main Application Container -->
    <div id="app-container" class="bg-white rounded-2xl shadow-xl max-w-4xl w-full p-6 sm:p-10 transition-all duration-300">
        <h1 class="text-3xl sm:text-4xl font-bold text-center text-indigo-700 mb-6 sm:mb-8">Argumentative Essay Assistant</h1>

        <!-- Content Area -->
        <div id="content-area" class="space-y-6">
            <!-- Current Step Indicator -->
            <div id="step-indicator" class="text-center text-sm text-gray-500 font-medium tracking-wide mb-4"></div>

            <!-- Prompt Display -->
            <div id="prompt-container" class="bg-indigo-50 border-l-4 border-indigo-500 rounded-lg p-4 mb-4">
                <h2 id="prompt-heading" class="text-xl sm:text-2xl font-semibold text-indigo-800"></h2>
            </div>
            
            <!-- Exemplar Display -->
            <div id="exemplar-container" class="bg-gray-50 border-l-4 border-gray-200 rounded-lg p-4 mb-4" style="display: none;">
                <p class="text-gray-500 italic text-sm">Example:</p>
                <p id="exemplar-text" class="text-gray-700 mt-1"></p>
            </div>

            <!-- User Input Area -->
            <textarea id="user-input" class="w-full h-40 p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-colors duration-200 resize-none text-gray-800"></textarea>

            <!-- Final Essay Display -->
            <div id="final-essay-container" class="bg-gray-50 p-6 rounded-2xl border border-gray-200 text-gray-800 hidden">
                <h3 class="text-2xl font-semibold text-center mb-4">Your Essay Draft</h3>
                <p id="final-essay-text" class="whitespace-pre-wrap leading-relaxed"></p>
                <button id="copy-button" class="mt-6 w-full bg-indigo-500 text-white font-bold py-3 px-6 rounded-xl hover:bg-indigo-600 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Copy to Clipboard</button>
            </div>

            <!-- Navigation Buttons -->
            <div class="flex justify-between items-center mt-6">
                <button id="prev-button" class="bg-gray-300 text-gray-700 font-bold py-2 px-6 rounded-xl hover:bg-gray-400 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed">Previous</button>
                <button id="next-button" class="bg-indigo-500 text-white font-bold py-2 px-6 rounded-xl hover:bg-indigo-600 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Next</button>
            </div>
        </div>
    </div>

    <!-- JavaScript for application logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // The template and exemplar data embedded directly from the provided CSV files.
            // The template now includes all three body paragraphs and the conclusion.
            const templateCSV = `INTRODUCTION
Define the Issue
Establish the significance
State your thesis

BODY PARAGARPH
Transition
First Reason (TS)
Transition
Counter-claim
Transition
Evidence
Transition
Rebuttal / Claim 1
Evidence
Elaboration
Transition
Claim 2
Transition
Evidence
"Elaboration, Link"

BODY PARAGRAPH
Transition
Second Reason (TS)
Transition
Counter-claim
Evidence
Transition
Rebuttal / Claim 1
Transition
Evidence
"Elaboration, Link"
Claim 2
Transition
Evidence
"Elaboration, Link"

BODY PARAGRAPH
Transition
Third Reason (TS)
Transition
Counter-claim
Evidence
Rebuttal / Claim 1
Evidence
"Elaboration, Link"
Claim 2
Evidence
"Elaboration, Link"

CONCLUSION
Restate thesis
Review reasons
Call to action`;

            // The exemplar data is also updated to reflect the full essay structure.
            const exemplarCSV = `INTRODUCTION
Define the Issue,Countless scientists and nature-lovers have the same item on their bucket lists: a visit to the Galapagos Islands. The environmental preserve made famous by Charles Darwin attracts loads of visitors every year.
Establish the significance,"While this can be great for education and tourism, it puts the sensitive ecosystem at risk."
State your thesis,"That is why, even though it offers some local and global benefits, Galapagos tourism should be discouraged because of the severe risks it poses to the environment."

BODY PARAGARPH
Transition,"One risk posed by Galapagos tourism"
First Reason (TS),is the degradation of the physical environment.
Transition,"It is often argued that "
Counter-claim,tourism provides the needed financial support to support and protect and maintain this ecosystem.
Transition,"Indeed, as passage one states, "
Evidence,""tourism in Ecuador ... generates $1.2 billion per year.""
Transition,"While this money is undoubtedly useful,"
Rebuttal / Claim 1, it has stimulated unregulated growth that is polluting a formerly peaceful environment:
Evidence,"“It’s unsustainable. More flights, more hotels, more cars. It's uncontrolled. We talk about ecotourism but in reality it's already showing signs of being mass tourism” (Passage 2)."
Elaboration,"Governments and businesses seek growth, so it is natural that a profitable tourist venture will lose sight of its environmental purpose and start to cause mass pollution."
Transition,"This pollution impacts the unique animal life."
Claim 2,"Now people want to swim with the seals and pose for photos, "
Evidence,reducing “a pristine natural environment” to a mere “place where tourists take ‘selfies’ with giant tortoises” (Passage Two).
"Elaboration, Link","If the Galapagos Islands are serious about promoting environmental preservation, they need to make this destination more about science and less about likes."

BODY PARAGRAPH
Transition,"In addition to putting plants and animals at risk,"
Second Reason (TS),turning a nature preserve into a tourist trap trivializes the serious scientific work it is meant to promote.
Transition,"It may be true that"
Counter-claim, seeing the many rare species on the Galapagos Islands can send visitors home with a 
Evidence,“renewed passion for the preservation of wildlife” (Passage One).
Transition,"Education is a noble goal, but the massive number of visitors is evidence that more than just conservationists are making this trip:"
Rebuttal / Claim 1,"“We talk about ecotourism, but…People aren't even coming for the wildlife any more. They just come for a vacation” (Passage Two). "
Evidence,"This change in public translates to changes in behaviors."
"Elaboration, Link","Now people want to swim with the seals and pose for photos,"
Claim 2,reducing “a pristine natural environment” to a mere “place where tourists take ‘selfies’ with giant tortoises” (Passage Two).
Transition,"The desire for photos and experiences also harms the animal population. "
Evidence,"This change in public translates to changes in behaviors."
"Elaboration, Link","If the Galapagos Islands are serious about promoting environmental preservation, they need to make this destination more about science and less about likes."

BODY PARAGRAPH
Transition,"Finally, the sheer number of visitors has overwhelmed the island’s fragile ecosystem."
Third Reason (TS),The massive number of visitors poses a threat to the native plants and animals.
Transition,"It can be said that "
Counter-claim,tourism provides the needed financial support to support and protect and maintain this ecosystem.
Evidence,"Indeed, as passage one states, “tourism in Ecuador ... generates $1.2 billion per year.”"
Rebuttal / Claim 1,"While this money is undoubtedly useful, it has stimulated unregulated growth that is polluting a formerly peaceful environment:"
Evidence,"“It’s unsustainable. More flights, more hotels, more cars. It's uncontrolled. We talk about ecotourism but in reality it's already showing signs of being mass tourism” (Passage 2)."
"Elaboration, Link","Governments and businesses seek growth, so it is natural that a profitable tourist venture will lose sight of its environmental purpose and start to cause mass pollution."
Claim 2,"The impact on the unique animal life is severe."
Evidence,reducing “a pristine natural environment” to a mere “place where tourists take ‘selfies’ with giant tortoises” (Passage Two).
"Elaboration, Link","If the Galapagos Islands are serious about promoting environmental preservation, they need to make this destination more about science and less about likes."

CONCLUSION
Restate thesis,It can clearly be seen that tourism to the Galapagos Islands has become unsustainable and dangerous.
Review reasons,"The massive number of visitors poses a threat to plants and animals, and has made the destination more about vacation than conservation."
Call to action,"The economic and educational benefits are still worthwhile, so the most sensible solution would be to impose limits that allow true ecotourism to continue while better protecting the environment. Otherwise, there will be nothing left for visitors to see on these special Ecuadorian islands."`;

            // --- DOM Elements ---
            const promptHeading = document.getElementById('prompt-heading');
            const exemplarContainer = document.getElementById('exemplar-container');
            const exemplarText = document.getElementById('exemplar-text');
            const userInput = document.getElementById('user-input');
            const prevButton = document.getElementById('prev-button');
            const nextButton = document.getElementById('next-button');
            const stepIndicator = document.getElementById('step-indicator');
            const finalEssayContainer = document.getElementById('final-essay-container');
            const finalEssayText = document.getElementById('final-essay-text');
            const contentArea = document.getElementById('content-area');
            const copyButton = document.getElementById('copy-button');

            // --- State Management ---
            let currentStep = 0;
            let studentResponses = {};
            let prompts = [];

            // --- Utility Functions ---

            /**
             * Parses the CSV data into a usable array of objects.
             * It handles newlines and quoted fields.
             * @param {string} templateData The raw CSV string for the template.
             * @param {string} exemplarData The raw CSV string for the exemplar.
             * @returns {Array<Object>} An array of objects, each with a 'prompt' and 'exemplar' property.
             */
            const parseCSV = (templateData, exemplarData) => {
                const templateLines = templateData.split(/\r?\n/).filter(line => line.trim() !== '');
                const exemplarLines = exemplarData.split(/\r?\n/).filter(line => line.trim() !== '');
                
                const parsedPrompts = [];
                let exemplarIndex = 0;

                for (let i = 0; i < templateLines.length; i++) {
                    const templateLine = templateLines[i].trim();
                    if (templateLine.toUpperCase() === 'INTRODUCTION' || templateLine.toUpperCase() === 'BODY PARAGRAPH' || templateLine.toUpperCase() === 'BODY PARAGARPH' || templateLine.toUpperCase() === 'CONCLUSION') {
                        continue; // Skip section headers
                    }

                    // Find the corresponding exemplar line.
                    let exemplarContent = '';
                    while (exemplarIndex < exemplarLines.length) {
                        let line = exemplarLines[exemplarIndex].trim();
                        // Handle quoted fields which can contain commas
                        const match = line.match(/^"([^"]+)"/);
                        const firstField = match ? match[1] : line.split(',')[0].trim();

                        if (firstField.toLowerCase() === templateLine.toLowerCase()) {
                            // Found the matching line, extract the rest of the content
                            const contentMatch = line.match(/^[^,]*,"(.*)"$/);
                            if (contentMatch) {
                                exemplarContent = contentMatch[1].replace(/""/g, '"'); // Unescape double quotes
                            } else {
                                // Simple case without quotes
                                const parts = line.split(',');
                                parts.shift(); // Remove the prompt name
                                exemplarContent = parts.join(',').trim();
                            }
                            exemplarIndex++;
                            break;
                        } else {
                            exemplarIndex++;
                        }
                    }
                    
                    parsedPrompts.push({
                        prompt: templateLine,
                        exemplar: exemplarContent.replace(/^"/, '').replace(/"$/, '').replace(/""/g, '"') // Clean up quotes
                    });
                }
                return parsedPrompts;
            };

            // --- Main Application Logic ---

            /**
             * Renders the UI based on the current step.
             */
            const renderStep = () => {
                // Check if we are at the end to display the final essay
                if (currentStep >= prompts.length) {
                    generateEssay();
                    return;
                }

                // Get the current prompt and exemplar
                const currentPrompt = prompts[currentStep];

                // Update the UI elements
                promptHeading.textContent = currentPrompt.prompt;
                exemplarText.textContent = currentPrompt.exemplar;
                
                // Show/hide exemplar container based on content
                if (currentPrompt.exemplar) {
                    exemplarContainer.style.display = 'block';
                } else {
                    exemplarContainer.style.display = 'none';
                }

                // Populate the textarea with the student's saved response, if any
                userInput.value = studentResponses[currentPrompt.prompt] || '';
                userInput.focus();

                // Update step indicator
                stepIndicator.textContent = `Step ${currentStep + 1} of ${prompts.length}`;

                // Manage button visibility
                prevButton.disabled = currentStep === 0;
            };

            /**
             * Navigates to the next step.
             */
            const handleNext = () => {
                const currentPrompt = prompts[currentStep].prompt;
                studentResponses[currentPrompt] = userInput.value;
                currentStep++;
                renderStep();
            };

            /**
             * Navigates to the previous step.
             */
            const handlePrev = () => {
                const currentPrompt = prompts[currentStep].prompt;
                studentResponses[currentPrompt] = userInput.value;
                currentStep--;
                renderStep();
            };

            /**
             * Compiles all the responses into a single, formatted essay.
             */
            const generateEssay = () => {
                let essayDraft = '';

                prompts.forEach((promptData, index) => {
                    const response = studentResponses[promptData.prompt] || '';
                    if (response.trim() === '') {
                        return; // Skip empty responses
                    }

                    // This logic intelligently adds newlines to format paragraphs correctly.
                    if (promptData.prompt === 'Define the Issue' || promptData.prompt === 'Transition' || promptData.prompt === 'Restate thesis') {
                        if (essayDraft.length > 0) {
                            essayDraft += '\n\n'; // Add two newlines for a new paragraph
                        }
                    }

                    // Add the response to the draft
                    essayDraft += response.trim() + ' ';
                });
                
                // Show the final essay container and hide the navigation
                contentArea.classList.add('hidden');
                finalEssayContainer.classList.remove('hidden');
                finalEssayText.textContent = essayDraft.trim();
            };

            /**
             * Copies the final essay text to the clipboard.
             */
            const copyEssayToClipboard = () => {
                const textToCopy = finalEssayText.textContent;
                // Use the deprecated but reliable method for iframes
                const textArea = document.createElement('textarea');
                textArea.value = textToCopy;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                } catch (err) {
                    console.error('Failed to copy text: ', err);
                }
                document.body.removeChild(textArea);

                // Provide user feedback
                copyButton.textContent = 'Copied!';
                setTimeout(() => {
                    copyButton.textContent = 'Copy to Clipboard';
                }, 2000);
            };

            // --- Event Listeners ---
            nextButton.addEventListener('click', handleNext);
            prevButton.addEventListener('click', handlePrev);
            copyButton.addEventListener('click', copyEssayToClipboard);

            // Initial setup
            prompts = parseCSV(templateCSV, exemplarCSV);
            renderStep();
        });
    </script>
</body>
</html>
